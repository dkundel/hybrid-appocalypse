<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/sloth.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <h1>Hybrid Appocalypse</h1>
        </section>
        <section>
          <div class="split">
            <div>
              <h1 style="font-size: 9em">Hi!</h1>
              <h2><b><i>I'm Dominik</i></b></h2>
            </div>
            <div>
              <img src="images/me-avatar.png">
            </div>
          </div>
        </section>
        <section>
          <div class="split">
            <div>
              <h3>About Me</h3>
              <p>Developer Evangelist at</p>
              <p><img src="images/Twilio_logo_white.png"></p>
              <p><i>Get in touch with me</i></p>
              <p>
                <a href="https://twitter.com/dkundel">@dkundel</a>
              </p>
              <p>
                <a href="mailto:dkundel@twilio.com">dkundel@twilio.com</a>
              </p>
              <p>
                <a href="https://github.com/dkundel">github/dkundel</a>
              </p>
            </div>
            <div>
              <img src="images/me-neutral.png">
            </div>
          </div>
        </section>
        <section data-background-image="images/apocalypse.jpg">
          <h1>Hybrid Appocalypse</h1>
        </section>
        <section>
          <h3>Hello</h3>

          <p>Hello <b>bold</b> and <i>italic</i></p>
        </section>
        <section class="original" data-background-image="http://i.giphy.com/26gJylriNURAvmjUA.gif">
          <h3>Success!</h3>
          <p>We made it!</p>
        </section>

        <section class="alternative code">
          <div class="wrapper">
            <pre><code class="input" data-command="python" data-trim contenteditable>
            </code></pre>
            <button class="execute">Run</button>
            <pre><code class="output" data-trim>
            </code></pre>
          </div>
        </section>
        
        <footer>
          Dominik Kundel | <a href="https://twitter.com/dkundel">@dkundel</a> | Devfest Austria
        </footer>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      Reveal.addEventListener( 'ready', function( event ) {
        document.querySelectorAll('section').forEach((e, idx) => {
          if (e.getAttribute('data-background-image') && e.className.indexOf('original') === -1) {
            let bg = document.querySelector('.slide-background:nth-of-type('+(idx+1)+')');
            if (bg.className.indexOf('filter-image') === -1) {
              bg.className += ' filter-image';
            }
          } 
          if (e.className.indexOf('alternative') !== -1) {
            console.log(e, idx);
            let bg = document.querySelector('.slide-background:nth-of-type('+(idx+1)+')');
            console.log(bg);
            if (bg.className.indexOf('alternative') === -1) {
              bg.className += ' alternative';
            }
          }
        });
        registerCodeButtons();
      });
      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        history: true,
        backgroundTransition: 'none',
        transition: 'none',
        controls: false,
        transitionSpeed: 'slow',

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: 'plugin/markdown/marked.js' },
          { src: 'plugin/markdown/markdown.js' },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
      });

      function registerCodeButtons() {
        if (typeof require === 'function') {
          document.querySelectorAll('section.code button.execute').forEach(registerExecute);
        } else {
          document.querySelectorAll('section.code').forEach(disableCoding)
        }
      }

      function disableCoding(elem) {

      }

      function registerExecute(elem) {
        const wrapper = elem.parentElement;
        const input = wrapper.querySelector('.input');
        const output = wrapper.querySelector('.output');
        
        const path = require('path');
        const fs = require('fs');
        const exec = require('child_process').exec;

        const command = input.getAttribute('data-command');
        const fileName = path.resolve(Math.random().toString(36).substr(2));

        elem.addEventListener('click', () => {
          let content = input.innerText;
          fs.writeFile(fileName, content, 'utf8', (err) => {
            if (err) {
              output.innerText = err.message;
              return;
            }

            exec(`${command} ${fileName}`, (err, stdout, stderr) => {
              if (err) {
                output.innerText = err.message;
                return;
              }
              output.innerText = stdout;

              fs.unlink(fileName, (err) => {
                if (err) {
                  console.error(err);
                }
              })
            });
          })
        });
      }

    </script>
  </body>
</html>
